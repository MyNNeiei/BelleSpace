{% extends 'layout.html' %}
{% load static %}

{% block title %}จองบริการ{% endblock %}

{% block content %}
<!-- พื้นหลังหน้าเว็บ -->
<div class="bg-[#74342B] min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">

    <!-- กล่องฟอร์ม -->
    <div class="max-w-md w-full space-y-8 bg-[#EDDCC2] p-6 rounded-lg shadow-md">

        <div>
            <h2 class="mt-6 text-center text-3xl font-extrabold text-[#74342B]">
                จองบริการ
            </h2>
        </div>

        <form class="mt-8 space-y-6 " id="appointmentForm" method="post" action="{% url 'appointment_form' %}">
            {% csrf_token %}
            <div class="rounded-md shadow-sm -space-y-px">
                <div class="mb-4">
                    <label for="staff" class="block text-sm font-medium text-[#74342B]">เลือกพนักงาน</label>

                    <select id="staff" name="staff"
                        class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm">

                        <option value="">เลือกพนักงาน</option>
                        
                        {% for staff in staff_list %}
                        <option value="{{ staff.id }}" class="text-black">{{ staff.position }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-4 mt-6">
                    <label class="block text-sm font-medium text-gray-700">เลือกหมวดหมู่</label>
                    <div class="mt-2 mb-6 space-x-2" id="categoryButtons">
                        {% for category in categories %}
                        <button type="button"
                            class="category-btn inline-flex items-center px-4 py-2 border text-sm font-3xl rounded-md text-[#3A1212] bg-[#D18F90] hover:bg-[#74342B] focus:bg-[#74342B]"
                            data-category="{{ category.id }}">
                            {{ category.name }}
                        </button>
                        {% endfor %}
                    </div>
                </div>

                {% for category_id, services in services_by_category.items %}
                <div class="mb-4 mt-6 hidden" id="services-{{ category_id }}">

                    <label class="block text-sm font-medium text-gray-700">เลือกบริการ</label>

                    <div class="mt-2 mb-6 space-y-2">
                        {% for service in services %}
                        <div class="flex items-center">
                            <input id="service-{{ service.id }}" name="services" value="{{ service.id }}"
                                type="checkbox"
                                class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                            <label for="service-{{ service.id }}" class="ml-2 block text-sm text-gray-900">
                                {{ service.name }}
                            </label>
                        </div>
                        {% endfor %}
                    </div>

                </div>
                {% endfor %}
                <div class="mb-4">
                    <label for="appointmentDate" class="block text-sm font-medium text-gray-700">วันที่นัดหมาย</label>
                    <input type="date" id="appointmentDate" name="appointment_date"
                        class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
            </div>

            <div>
                <button type="submit"
                    class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-[#74342B] hover:bg-[#74342B]">
                    จองคิว
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const categoryButtons = document.querySelectorAll('.category-btn');
        const servicesSections = document.querySelectorAll('[id^="services-"]');

        categoryButtons.forEach(button => {
            button.addEventListener('click', function () {
                const categoryId = this.dataset.category;

                servicesSections.forEach(section => section.classList.add('hidden'));
                document.getElementById(`services-${categoryId}`).classList.remove('hidden');

                categoryButtons.forEach(btn => btn.classList.remove('bg-[#74342B]', 'text-white'));
                this.classList.add('bg-[#74342B]', 'text-white');
            });
        });

        const form = document.getElementById('appointmentForm');
        form.addEventListener('submit', function (e) {
            const selectedServices = document.querySelectorAll('input[name="services"]:checked');
            if (selectedServices.length === 0) {
                e.preventDefault();
                alert('กรุณาเลือกบริการอย่างน้อยหนึ่งรายการ');
            }
        });
    });
</script>
{% endblock %}